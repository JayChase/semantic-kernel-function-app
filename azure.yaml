# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json

name: sk-function-app
metadata:
  template: sk-function-app

workflows:
  up:
    - azd: provision
    - azd: package --all
    - azd: deploy --all

hooks:
  postprovision:
    posix:
      shell: sh
      run: ./infra/replace-placeholders.sh ng-web/src/environments/environment-template.ts ng-web/src/environments/environment.ts && ./infra/update-local-settings.sh && ./infra/az-user-openai-authz.sh
    windows:
      shell: pwsh
      run: ./infra/replace-placeholders.ps1 ng-web/src/environments/environment-template.ts ng-web/src/environments/environment.ts; ./infra/update-local-settings.ps1; ./infra/az-user-openai-authz.ps1

services:
  ngWeb:
    project: ./ng-web
    host: appservice
    language: js
    dist: dist/ng-web
  skChat:
    project: ./sk-chat/SkChat
    language: dotnet
    host: function
